<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for spec\Firefox\FileUtilitiesSpec.js</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../prettify.css">
    <link rel="stylesheet" href="../../base.css">
    <style type='text/css'>
        div.coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class="header high">
    <h1>Code coverage report for <span class="entity">spec\Firefox\FileUtilitiesSpec.js</span></h1>
    <h2>
        Statements: <span class="metric">99.03% <small>(102 / 103)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Branches: <span class="metric">100% <small>(6 / 6)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Functions: <span class="metric">95.24% <small>(20 / 21)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Lines: <span class="metric">99.03% <small>(102 / 103)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../index.html">All files</a> &#187; <a href="index.html">spec/Firefox/</a> &#187; FileUtilitiesSpec.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-yes">7</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">///&lt;reference path="../support/jasmine.d.ts" /&gt;
&nbsp;
require("babel/register");
&nbsp;
const Constants = require("../../lib/Constants");
const FileUtilities = require("../../lib/Firefox/FileUtilities");
&nbsp;
describe("FileUtilities", function () {
	var _sut;
	var _mockFileSystem;
	var _mockWindowUtilities;
	beforeEach(function () {
		_mockFileSystem = {};
		_mockWindowUtilities = {};
		_sut = new FileUtilities(_mockFileSystem, _mockWindowUtilities);
	});
&nbsp;
	describe("create", function () {
		it("should call initWithPath then return the file when fileInfo is the path to the file", function () {
			//arrange
			var mockFile = jasmine.createSpyObj("mockFile", ["initWithPath"]);
			var fileInfo = "this is a type of string";
&nbsp;
			_mockFileSystem.createLocalFile = jasmine.createSpy("mockCreateLocalFile").and.returnValue(mockFile);
&nbsp;
			//act
			var actual = _sut.create(fileInfo);
			
			//assert
			expect(_mockFileSystem.createLocalFile).toHaveBeenCalledWith();
			expect(mockFile.initWithPath).toHaveBeenCalledWith(fileInfo);
			expect(actual).toBe(mockFile);
		});
		it("should call initWithFile then return the file when fileInfo the file object itself", function () {
			//arrange
			var mockFile = jasmine.createSpyObj("mockFile", ["initWithFile"]);
			var fileInfo = {};
&nbsp;
			_mockFileSystem.createLocalFile = jasmine.createSpy("mockCreateLocalFile").and.returnValue(mockFile);
&nbsp;
			//act
			var actual = _sut.create(fileInfo);
			
			//assert
			expect(_mockFileSystem.createLocalFile).toHaveBeenCalledWith();
			expect(mockFile.initWithFile).toHaveBeenCalledWith(fileInfo);
			expect(actual).toBe(mockFile);
		});
	});
	describe("readBytes", function () {
		it("should return filesystem.read", function () {
			//arrange
			var file = "file";
			var filePath = "path to file";
			_mockFileSystem.read = jasmine.createSpy("mockRead").and.returnValue(file);
&nbsp;
			//act
			var actual = _sut.readBytes(filePath);
			
			//assert
			expect(actual).toBe(file);
			expect(_mockFileSystem.read).toHaveBeenCalledWith(filePath);
		});
	});
	describe("openFileBrowser", function () {
		it("should return a promise which resolves with the files chosen in the file browser", function () {
			//arrange
			var hasMoreElementsCalls = 0;
			var getNextCalls = 0;
			var createLocalFileCalls = 0;
			var mostRecentWindow = "a window";
			var file1 = { path: "path1", leafName: "leafName1", initWithFile: jasmine.createSpy("initWithFile") };
			var file2 = { path: "path2", leafName: "leafName2", initWithFile: jasmine.createSpy("initWithFile") };
			var file1Type = "file1Type";
			var file2Type = "file2Type";
			var mockFiles = jasmine.createSpyObj("mockFiles", ["hasMoreElements", "getNext"]);
			var mockFilePicker = jasmine.createSpyObj("mockFilePicker", ["init", "appendFilters", "open"]);
			mockFilePicker.files = mockFiles;
&nbsp;
			_mockFileSystem.createLocalFile = jasmine.createSpy("createLocalFile").and.callFake(function () {
				createLocalFileCalls++;
				return createLocalFileCalls == 1 ? file1 : file2;
			});
			_mockFileSystem.getTypeFromFile = jasmine.createSpy("getTypeFromFile").and.callFake(function (file) {
				return file == file1 ? file1Type : file2Type;
			});
			_mockFileSystem.filePicker = jasmine.createSpy("filePicker").and.returnValue(mockFilePicker);
			_mockWindowUtilities.getMostRecentBrowserWindow = jasmine.createSpy("getMostRecentBrowserWindow").and.returnValue(mostRecentWindow);
			mockFiles.hasMoreElements.and.callFake(function () {
				hasMoreElementsCalls++;
				return hasMoreElementsCalls &lt; 3;
			});
			mockFiles.getNext.and.callFake(function () {
				getNextCalls++;
				return getNextCalls == 1 ? file1 : file2;
			});
&nbsp;
			//act
			_sut.openFileBrowser().then(function (actual) {
				expect(Array.isArray(actual)).toBeTruthy();
				expect(actual.length).toBe(2);
&nbsp;
				expect(typeof actual[0]).toBe("object");
				expect(actual[0].path).toBe(file1.path);
				expect(actual[0].name).toBe(file1.leafName);
				expect(actual[0].type).toBe(file1Type);
&nbsp;
				expect(typeof actual[1]).toBe("object");
				expect(actual[1].path).toBe(file2.path);
				expect(actual[1].name).toBe(file2.leafName);
				expect(actual[1].type).toBe(file2Type);
			});
			
			//assert
			expect(_mockWindowUtilities.getMostRecentBrowserWindow).toHaveBeenCalledWith();
			expect(_mockFileSystem.filePicker).toHaveBeenCalledWith();
			expect(mockFilePicker.init).toHaveBeenCalledWith(mostRecentWindow, Constants.addonSdk.filePicker.windowTitle, Constants.addonSdk.filePicker.modeOpenMultiple);
			expect(mockFilePicker.appendFilters).toHaveBeenCalledWith(Constants.addonSdk.filePicker.filterAll);
			expect(mockFilePicker.open).toHaveBeenCalledWith(jasmine.any(Function));
&nbsp;
			//execute funciton from open
			mockFilePicker.open.calls.argsFor(0)[0](Constants.addonSdk.filePicker.returnOK);
		});
	});
	it("should reject the promise when open doesn't return ok", function () {
		//arrange
		var mostRecentWindow = "a window";
		var mockFilePicker = jasmine.createSpyObj("mockFilePicker", ["init", "appendFilters", "open"]);
&nbsp;
		_mockFileSystem.filePicker = jasmine.createSpy("filePicker").and.returnValue(mockFilePicker);
		_mockWindowUtilities.getMostRecentBrowserWindow = jasmine.createSpy("getMostRecentBrowserWindow").and.returnValue(mostRecentWindow);
&nbsp;
		//act/assert
		_sut.openFileBrowser().then(
<span class="fstat-no" title="function not covered" >			function () {</span> <span class="cstat-no" title="statement not covered" >fail("resolve should not have been called."); </span>},
			function (reason) { expect(reason).toBe(Constants.addonSdk.filePicker.noFilesChosen); });
		mockFilePicker.open.calls.argsFor(0)[0](Constants.addonSdk.filePicker.noFilesChosen);
	});
	describe("getMimeType", function () {
		it("should return file type from file system", function () {
			//arrange
			var fileType = "fileType";
			var myFile = "myFile";
			_mockFileSystem.getTypeFromFile = jasmine.createSpy("getTypeFromFile").and.returnValue(fileType);
&nbsp;
			//act
			var actual = _sut.getMimeType(myFile);
&nbsp;
			//assert
			expect(_mockFileSystem.getTypeFromFile).toHaveBeenCalledWith(myFile);
			expect(actual).toBe(fileType);
		});
		it("should return default mime type when file system throws error", function () {
			//arrange
			var myFile = "myFile";
			_mockFileSystem.getTypeFromFile = jasmine.createSpy("getTypeFromFile").and.callFake(function () {
				throw new Error("File System Error!!!");
			});
&nbsp;
			//act
			var actual = _sut.getMimeType(myFile);
&nbsp;
			//assert
			expect(_mockFileSystem.getTypeFromFile).toHaveBeenCalledWith(myFile);
			expect(actual).toBe(Constants.defaultMimeType);
		});
	});
});</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sat Jun 27 2015 17:35:50 GMT-0500 (Central Daylight Time)</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
